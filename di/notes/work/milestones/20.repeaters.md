# Repeaters

i want a way to automagically add/remove repeated elements like stairs (range for rise), studs (local building code)

## Examples

- stairs: template = one step (w, rise, run) → count = `total_height / rise`
- studs: template = one stud (w, h, thickness) → count = `wall_length / spacing` (rounded)

---

## Phase 1 — Data model

- [x] add `repeater: { count_formula: string } | null` to Smart_Object
- [x] add `is_template: boolean` flag to Smart_Object (marks the first child as the template)
- [x] serialize/deserialize both fields in Smart_Object

## Phase 2 — Engine: generate copies

- [ ] `Engine.set_repeater(so, count_formula)` — compiles formula, marks SO as repeater
- [ ] `Engine.sync_repeater(so)` — evaluates count, creates/removes cloned children to match
  - clones copy template's dimensions
  - each clone's position offset = template size × index (axis determined by template's largest dimension)
- [ ] call `sync_repeater` after any propagation that touches a repeater SO

## Phase 3 — Constraints integration

- [ ] when `propagate(so)` runs and `so` is a repeater, call `sync_repeater(so)` after
- [ ] when `propagate_all()` runs, sync all repeater SOs after

## Phase 4 — UI

- [ ] D_Selection: "repeat" button → opens inline count formula input
- [ ] D_Selection: show count formula when SO is a repeater (editable)
- [ ] D_List: badge repeated children with dim styling (e.g. `×3`)

## Phase 5 — Examples / test

- [ ] build a stairs preset in the library (step SO + repeater parent)
- [ ] build a studs preset (stud SO + repeater parent with code-derived spacing)
