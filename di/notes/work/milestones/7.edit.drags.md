# Milestone 7: Edit Drags

**Started:** Feb 3, 2026 | **Completed:** Feb 4, 2026 | **Status:** done

## Goal

Make selected geometry editable by dragging. only faces can be selected. drag only works on a corner or an edge of the selected face. editing is geometrically confined to the 2D plane of the selected face.

---

## Our Work

### Understand current state

- [x] How does rotation drag work now? — `e3.set_drag_handler` in Setup.ts always calls `rotate_object`
- [x] What's the relationship between screen delta and world delta? — camera at (0,0,5), right=(1,0,0), up=(0,1,0)
- [x] Where do the cube vertices live? — O_Scene.vertices, but both cubes shared same array (fixed)

### Design

- [x] Should edit drag modify O_Scene vertices directly, or go through SO? — through SO (move_vertex, move_vertices)
- [x] How to detect "drag on selection" vs "drag to rotate"? — `edit_selection` returns true if selection exists
- [x] What happens to inner cube when outer cube's corner moves? — nothing, they have separate vertex arrays now

### Implement

- [x] Clone vertices on Scene.create (so each object has its own)
- [x] Add Point3.clone() method
- [x] Add move_vertex, move_vertices, edge_vertices, face_vertices to Smart_Object
- [x] Add screen_to_world, edit_selection to Events_3D
- [x] Route drag: selection ? edit : rotate (Setup.ts)
- [x] eliminate selection of edge or corner
- [x] click-drag only applies to an edge or a corner
- [x] drag is geometrically confined to the 2D plane of the selected face

### Test manually

- [x] Click corner, drag — resizes 2 dimensions
- [x] Click edge, drag — resizes 1 dimension
- [x] Click face interior — selects face (no drag)
- [x] Click empty, drag — rotates as before
- [x] Hover disabled during drag/rotation

### Polish

- [x] Visual feedback during drag

---

## Artifacts

- `src/lib/ts/runtime/Smart_Object.ts` — bounds-based geometry (x/y/z_min/max), derived vertices, face_normal, corner_in_face, edge_in_face, vertex_bound, edge_bound, axis_vector
- `src/lib/ts/signals/Events_3D.ts` — ray-plane intersection, edit_selection, drag_target tracking, hover clearing
- `src/lib/ts/render/Setup.ts` — route drag by selection
- `src/lib/md/builds.md` — build 7 entry

## Key Decisions

- **Bounds-based geometry**: SO stores 6 bounds instead of 8 vertices. Simpler, supports negative dimensions.
- **Vertices derived**: `get vertices()` computes from bounds using Math.min/max for consistent topology.
- **Ray-plane projection**: Mouse positions projected onto face plane to get world-space delta.
- **Bound ownership**: `vertex_bound()` maps vertex index to named bound it controls (for drag application).
