# Milestone 8: Dimensions

**Started:** Feb 4, 2026 | **Status:** in progress

## Goal

Render dimensions on selected geometry: terminator arrows, dimension text, dimension lines, witness lines. Then make them editable — changing a dimension value updates the geometry.

---

## Our Work

### Understand current state

- [x] How are faces/edges identified for dimensioning?
  - Selection is `Hit_3D_Result`: `{ so: Smart_Object, type: T_Hit_3D.face, index: 0-5 }`
  - Face indices: 0=front(z_min), 1=back(z_max), 2=left(x_min), 3=right(x_max), 4=top(y_max), 5=bottom(y_min)
  - `so.face_axes(face_index)` returns 2 axes to dimension (e.g., face 0 → ['x','y'])
  - `so.face_vertices(face_index)` returns 4 corner indices
  - Each face has 4 edges from `cube_edges` topology

- [x] What's the rendering pipeline — where do annotations fit?
  - `render.render()` → `render_object()` for each → `render_selection()` → `render_hover()`
  - Dimensions go after `render_selection()` — they annotate the selected face
  - Projected vertices available via `hits_3d.get_projected(scene_id)`
  - Canvas 2D context available throughout

- [x] How does text rendering work (or does it)?
  - Canvas 2D has `ctx.fillText()`, `ctx.measureText()` — no custom system needed
  - Just need font size, alignment, positioning

### Design

- [x] What is a "dimension" — data structure, ownership, lifecycle?
  - A dimension annotates one axis of the selected face
  - Shows: value, witness lines, dimension line, terminator arrows
  - Lifecycle: exists only while face is selected

- [x] Where do dimensions live — on SO, separate collection, derived?
  - **Derived on render** — computed each frame from selection + SO bounds
  - No persistent structure needed (YAGNI)
  - Render.ts calculates dimension info, draws it

- [x] How does dimension editing flow back to geometry?
  - Click text → edit mode (handled by Svelte component overlay)
  - Type value → apply → adjust bounds symmetrically or from one side
  - For axis 'x': new_width affects x_min and/or x_max

### Implement

- [ ] Dimension data structure
- [ ] Witness lines (perpendicular to measured edge)
- [ ] Dimension line (parallel, between witnesses)
- [ ] Terminator arrows
- [ ] Dimension text (value centered on dimension line)
- [ ] Edit interaction (click text, type value, apply)

### Test manually

- [ ] Select face — shows dimensions for that face's edges
- [ ] Dimensions update when geometry dragged
- [ ] Edit dimension value — geometry resizes accordingly
- [ ] change resume -> revisit

### Tweaks

- [ ] gap in dimension lines to give room for text
- [ ] witness lines should be planar with the face
- [ ] dimensions should always be visible with the following rules:
	- [ ] they are never in front of another face of the SO
	- [ ] there are only ever three dimensions, one for each of the 3D

---

## Artifacts

*(to be filled as work progresses)*

## Key Decisions

*(to be captured as decisions are made)*
